# Task 1: Introduction

Authentication enumeration is a fundamental aspect of security testing, concentrating specifically on the mechanisms that protect sensitive aspects of web applications. This process involves methodically inspecting various authentication components, ranging from username validation to password policies and session management. Each of these elements is meticulously tested because they represent potential vulnerabilities that, if exploited, could lead to significant security breaches.

---

## Objectives

By the end of this room, you will:

- **Understand the significance of enumeration** and how it sets the stage for effective brute-force attacks.
- **Learn advanced enumeration methods**, mainly focusing on extracting information from verbose error messages.
- **Comprehend the relationship** between enumeration and brute-force attacks in compromising authentication mechanisms.
- **Gain practical experience** using tools and techniques for both enumeration and brute-force attacks.

---

## Pre-requisites

Before starting this room, you should have a basic understanding of the following concepts:

- **Familiarity with HTTP and HTTPS**, including request/response structures and common status codes.
- **Experience using tools like Burp Suite**.
- **Basic proficiency in navigating and using the Linux command line**.

# Task 2 : Authentication Enumeration


## Overview

Authentication enumeration is the process of acting as a **digital detective**. It’s not just about picking up clues—it's about understanding what these clues reveal about the security of a system. Think of it as piecing together a puzzle rather than just ticking off items on a checklist.

This process is like **peeling back the layers of an onion**: each layer of a system’s security is examined to reveal the real operations underneath. It’s not just routine checks; it’s about understanding how everything is interconnected.

---

## Key Concepts

### 1. Identifying Valid Usernames

Knowing a valid username allows an attacker to focus their efforts on discovering the associated password. Usernames can be identified in various ways, such as:

- **Observing application responses** during login or password resets.
- **Interpreting error messages**, such as:
  - `"This account doesn’t exist"` (indicates an invalid username).
  - `"Incorrect password"` (hints at a valid username).

Such responses provide attackers with valuable information, reducing their guesswork.

---

### 2. Password Policies

Understanding password policies can offer insights into the complexity of the passwords used in an application. Attackers can analyze these policies to tailor their strategies.

For instance, the following PHP code snippet uses **regex** to enforce a password policy that includes symbols, numbers, and uppercase letters:

```php
<?php
$password = $_POST['pass']; // Example1
$pattern = '/^(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).+$/';

if (preg_match($pattern, $password)) {
    echo "Password is valid.";
} else {
    echo "Password is invalid. It must contain at least one uppercase letter, one number, and one symbol.";
}
?>

```

In the above example, if the supplied password doesn't satisfy the policy defined in the pattern variable, the application will return an error message revealing the regex code requirement. An attacker might generate a dictionary that satisfies this policy.

## Common Places to Enumerate

Web applications often include features designed to enhance user experience, but these can inadvertently expose security vulnerabilities. Below are some common areas where enumeration is possible:

---

### 1. Registration Pages

User registration processes are usually designed to be simple and informative, providing immediate feedback on username or email availability. However, this feature can unintentionally expose sensitive information:

- **How it works**: If a user tries to register with an already-taken email or username, the application typically notifies them (e.g., `"This username is already taken"` or `"Email already in use"`).
- **Exploitation**: 
  - Attackers can attempt to register with potential usernames or emails.
  - Responses allow them to compile a list of valid users, without accessing the underlying database.

---

### 2. Password Reset Features

Password reset mechanisms are intended to help users regain access to their accounts but can reveal more than intended:

- **How it works**: Users enter their details (e.g., email or username) to receive reset instructions.
- **Exploitation**:
  - Variations in feedback (e.g., `"This username does not exist"` versus `"Password reset link sent"`) confirm valid usernames.
  - Attackers analyze these differences to refine their list of valid accounts.

---

### 3. Verbose Errors

Verbose error messages are another common source of unintended information leakage:

- **How it works**: Applications often provide specific feedback during login attempts, such as:
  - `"Username not found"` versus `"Incorrect password"`.
- **Exploitation**: 
  - Such messages allow attackers to:
    - Confirm valid usernames.
    - Use this information to craft more targeted attacks.

---

### 4. Data Breach Information

Data from previous breaches provides attackers with a wealth of pre-validated credentials:

- **How it works**: Attackers use breached usernames and passwords to test for reuse across platforms.
- **Exploitation**:
  - A match suggests both:
    - Username reuse across platforms.
    - Potential password recycling.
  - This highlights how a single breach can compromise multiple accounts tied to the same identity.

---

By understanding these common enumeration points, defenders can better secure their applications and minimize the risk of exposure.

### What type of error messages can unintentionally provide attackers with confirmation of valid usernames?
Verbose errors

# Task 3 : Enumerating Users via Verbose Errors

## Overview

Verbose errors are like **unintentional whispers** from a system, revealing secrets that should remain hidden. While these detailed error messages are invaluable for developers during debugging, they can also provide attackers with critical insights. Imagine you're a detective with a knack for spotting clues—verbose errors offer a treasure trove of information to those who know how to listen.

---

## Insights Gained from Verbose Errors

Verbose errors can inadvertently expose sensitive data, such as:

- **Internal Paths**: Like a map to hidden treasures, these reveal file paths and directory structures of the server, potentially exposing configuration files or secret keys.
- **Database Details**: Errors might disclose database schema information, such as table names or column details.
- **User Information**: Some errors can hint at usernames or personal data, offering clues for further exploitation.

---

## Inducing Verbose Errors

Attackers use various techniques to provoke verbose errors, forcing applications to reveal unintended information:

1. **Invalid Login Attempts**  
   - By entering incorrect usernames or passwords, attackers trigger error messages that differentiate valid and invalid usernames.
   - Example: `"Invalid username"` vs. `"Incorrect password"`.

2. **SQL Injection**  
   - Injecting malicious SQL commands into input fields can cause database errors that reveal schema details.
   - Example: Entering a single quote (`'`) in a login field might result in an error exposing table structures.

3. **File Inclusion/Path Traversal**  
   - Manipulating file paths to access restricted areas can lead to errors disclosing internal paths.
   - Example: Using `../../` sequences in file paths.

4. **Form Manipulation**  
   - Altering form fields or parameters can coax the application into revealing backend logic or sensitive data.
   - Example: Tweaking hidden form fields to trigger validation errors.

5. **Application Fuzzing**  
   - Tools like **Burp Suite Intruder** bombard applications with varied payloads to provoke and analyze errors.
   - Example: Sending unexpected inputs to identify weak points.

---

## The Role of Enumeration and Brute Forcing

Verbose errors play a pivotal role in authentication attacks, complementing enumeration and brute-forcing strategies:

- **User Enumeration**:
  - Discovering valid usernames through error messages reduces guesswork for brute-force attacks.
- **Exploiting Verbose Errors**:
  - Insights about password policies or account lockout mechanisms enhance the precision of brute-force techniques.

---

## Summary

Verbose errors are like breadcrumbs, leading attackers deeper into the system. By exploiting these errors, attackers can:

- Discover sensitive information.
- Tailor their strategies for brute-force attacks.
- Potentially compromise security in ways that might go unnoticed until it’s too late.

Defenders must ensure that error messages are generic and avoid revealing unnecessary details, reducing the risk of exploitation.

## Automation

Below is a Python script that will check for valid emails in the target web app. Save the code below as script.py.

```py
import requests
import sys

def check_email(email):
    url = 'http://enum.thm/labs/verbose_login/functions.php'  # Location of the login function
    headers = {
        'Host': 'enum.thm',
        'User-Agent': 'Mozilla/5.0 (X11; Linux aarch64; rv:102.0) Gecko/20100101 Firefox/102.0',
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Accept-Language': 'en-US,en;q=0.5',
        'Accept-Encoding': 'gzip, deflate',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'X-Requested-With': 'XMLHttpRequest',
        'Origin': 'http://enum.thm',
        'Connection': 'close',
        'Referer': 'http://enum.thm/labs/verbose_login/',
    }
    data = {
        'username': email,
        'password': 'password',  # Use a random password as we are only checking the email
        'function': 'login'
    }

    response = requests.post(url, headers=headers, data=data)
    return response.json()

def enumerate_emails(email_file):
    valid_emails = []
    invalid_error = "Email does not exist"  # Error message for invalid emails

    with open(email_file, 'r') as file:
        emails = file.readlines()

    for email in emails:
        email = email.strip()  # Remove any leading/trailing whitespace
        if email:
            response_json = check_email(email)
            if response_json['status'] == 'error' and invalid_error in response_json['message']:
                print(f"[INVALID] {email}")
            else:
                print(f"[VALID] {email}")
                valid_emails.append(email)

    return valid_emails

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 script.py <email_list_file>")
        sys.exit(1)

    email_file = sys.argv[1]

    valid_emails = enumerate_emails(email_file)

    print("\nValid emails found:")
    for valid_email in valid_emails:
        print(valid_email)

```

### What is the valid email address from the list?
canderson@gmail.com

# Task 4 : Exploiting Vulnerable Password Reset Logic



The password reset mechanism is an essential feature for user convenience in modern web applications. However, its implementation must prioritize security, as poorly secured processes can be easily exploited.

---

## Common Reset Methods and Their Vulnerabilities

### 1. Email-Based Reset

- **How it works**:  
  The application sends an email containing a reset link or token to the user’s registered email address. The user uses this link to reset their password or receive a system-generated one.
- **Key vulnerability**:  
  This method heavily depends on the security of:
  - The user's email account.
  - The secrecy of the reset link or token.
- **Potential exploit**:  
  If an attacker gains access to the email account or intercepts the reset link, they can compromise the account.

---

### 2. Security Question-Based Reset

- **How it works**:  
  The user answers a series of pre-configured security questions. If the answers are correct, they can proceed with the reset.
- **Key vulnerability**:  
  Attackers can exploit this method if:
  - The questions rely on personally identifiable information (PII) that can be guessed or found online (e.g., mother’s maiden name, birthplace).
- **Potential exploit**:  
  Using publicly available information to bypass security questions.

---

### 3. SMS-Based Reset

- **How it works**:  
  A reset code or link is sent via SMS to the user's mobile phone. The user enters the code to reset their password.
- **Key vulnerability**:  
  This method is susceptible to:
  - SIM swapping attacks.
  - Interception of SMS messages.
- **Potential exploit**:  
  Attackers impersonate the victim to obtain their phone number or intercept messages using vulnerabilities in mobile networks.

---

## General Vulnerabilities in Password Reset Mechanisms

1. **Predictable Tokens**  
   - Tokens in reset links or SMS messages might follow a sequential or easily guessable pattern.  
   - **Exploitation**: Attackers brute-force or guess valid tokens to gain unauthorized access.

2. **Token Expiration Issues**  
   - Tokens that remain valid for extended periods or fail to expire immediately after use create a window for exploitation.  
   - **Mitigation**: Ensure tokens expire quickly and can be used only once.

3. **Insufficient Validation**  
   - Weak mechanisms for verifying user identity, such as easily guessed security questions or email validation, can be exploited.  
   - **Exploitation**: Attackers use known or guessed PII to bypass validation.

4. **Information Disclosure**  
   - Specific error messages like `"This email is not registered"` or `"Username does not exist"` inadvertently confirm account existence.  
   - **Exploitation**: Attackers use this information for enumeration.

5. **Insecure Transport**  
   - Reset links or tokens sent over non-HTTPS connections are vulnerable to interception.  
   - **Mitigation**: Use HTTPS to secure communication channels.

---

## Exploiting Predictable Tokens

Attackers target predictable or weak tokens in reset flows to gain unauthorized access. Common techniques include:

- **Brute-forcing sequential tokens**:  
  If tokens follow a pattern (e.g., `token123`, `token124`), attackers can guess the next valid token.
- **Analyzing weak randomness**:  
  Tokens generated with insufficient entropy can be deduced based on known inputs.

---

## Conclusion

Password reset flows are a critical component of application security but can become a major vulnerability if not implemented securely. Developers must ensure:

- **Tokens are random, unique, and short-lived**.
- **User identity verification is robust**.
- **Error messages and transport methods do not leak information**.

These measures help reduce the attack surface and protect user accounts from unauthorized access.

### Demo : How it can works for token auth.

#### 1. We will generate token auth using the tool crunch
```bash
root@ip-10-10-207-2:~# crunch 3 3 -o otp.txt -t %%% -s 100 -e 200
Crunch will now generate the following amount of data: 404 bytes
0 MB
0 GB
0 TB
0 PB
Crunch will now generate the following number of lines: 101 

crunch: 100% completed generating output
```

#### 2. We will use Burp Intruder to brute force the url 

#### What is the flag ?
THM{50_pr3d1ct4BL333!!}

# Task 5 : Exploiting HTTP Basic Authentication


## Overview

**Basic authentication** provides a straightforward method for securing access to devices. It relies on a simple **username and password** combination, making it easy to implement and manage, particularly on devices with limited processing capabilities.

---

## Common Use Cases

1. **Network Devices**  
   - Used in devices like routers to control access to administrative interfaces.
   - Focus is on preventing unauthorized access with minimal setup.

2. **Simple Environments**  
   - Suitable where session management and user tracking are unnecessary.
   - Often implemented in scenarios where configuration changes are infrequent.

---

## Key Features and Limitations

### Features
- **Ease of Implementation**:  
  - Quick to set up and requires minimal resources.
- **RFC 7617 Compliance**:  
  - Credentials (username and password) are sent as a base64-encoded string within the HTTP `Authorization` header.

### Limitations
1. **Lack of Encryption**:  
   - Base64 encoding is not encryption; it can be easily decoded if intercepted.  
   - **Mitigation**: Always use HTTPS to secure the transport layer.

2. **Weak Credentials**:  
   - Simple or default passwords are vulnerable to brute-force attacks.  
   - **Mitigation**: Enforce strong password policies.

3. **No Session Management**:  
   - Each request must include credentials, increasing overhead.  
   - **Mitigation**: Use token-based or OAuth schemes where session management is needed.

---

## HTTP Basic Authentication: How It Works

Basic authentication operates via a **challenge-response mechanism**:

1. **Request**:  
   The client sends a request without credentials.

2. **Response**:  
   The server responds with `401 Unauthorized` and includes the `WWW-Authenticate` header specifying the required authentication method (`Basic`).

3. **Authorization Header**:  
   The client resends the request with the `Authorization` header:
   ```http
   Authorization: Basic <credentials>
   ```

## Exploitation

```bash
hydra -l admin -P /usr/share/wordlists/SecLists/Passwords/Common-Credentials/500-worst-passwords.txt -s 80 -f -vV enum.thm http-get /labs/basic_auth/

```
Result: 

```bash
[80][http-get] host: enum.thm   login: admin   password: yellow
[STATUS] attack finished for enum.thm (valid pair found)

```

### Flag:
THM{b4$$1C_AuTTHHH} 

# Task 6 :OSINT

## Wayback URLs and Google Dorks

## Wayback URLs
The **Wayback Machine**, provided by the Internet Archive, allows users to access historical snapshots of websites. This can be particularly useful for various activities such as recovering lost content, analyzing website history, or conducting security assessments. Here are some practical tools and methods related to Wayback URLs:

### Useful Tools for Wayback URLs
1. **Wayback Machine**  
   - **URL**: [archive.org/web](https://archive.org/web)
   - This is the primary tool for searching and accessing historical versions of websites. By entering a URL, users can view archived versions from different dates.

2. **Waybackurls** (by Gobuster)
   - **Tool**: [Waybackurls](https://github.com/tomnomnom/waybackurls)  
   - This command-line tool helps gather all the URLs of a website that have been archived by the Wayback Machine. It is often used for finding previously indexed pages that may have been removed or are not easily accessible anymore.
   - Example command:  
     ```bash
     waybackurls example.com
     ```

3. **Waybackpy** (Python tool)
   - **Tool**: [Waybackpy](https://github.com/deedy5/waybackpy)
   - Waybackpy is a Python tool that allows users to interact programmatically with the Wayback Machine to retrieve historical data from URLs.
   - Example usage:
     ```python
     from waybackpy import WaybackMachineCDXServerAPI
     url = "http://example.com"
     cdx_api = WaybackMachineCDXServerAPI(url)
     cdx_api.save()
     print(cdx_api.first())
     ```

### Use Cases for Wayback URLs
- **Recover lost content**: View a page that no longer exists or has been taken down.
- **Web scraping or crawling**: Analyze how a website has evolved over time.
- **Security assessments**: Discover old, unpatched versions of a site that might expose vulnerabilities or outdated information.

---

## Google Dorks
**Google Dorking** (also known as Google Hacking) is the technique of using advanced search operators in Google to locate hidden or sensitive information. Google Dorks can help find exposed files, vulnerabilities, or data that is not indexed by typical search queries.

### Useful Google Dorking Operators
Here are some commonly used Google Dorking operators to find sensitive data:

1. **`site:`** - Restrict search results to a specific website or domain.
   - Example:  
     ```bash
     site:example.com
     ```
2. **`filetype:`** - Search for specific file types like `.pdf`, `.xls`, `.doc`, etc.
   - Example:  
     ```bash
     filetype:pdf site:example.com
     ```
3. **`intitle:`** - Search for specific words in the title of a webpage.
   - Example:  
     ```bash
     intitle:"index of" site:example.com
     ```
4. **`inurl:`** - Search for specific words in the URL.
   - Example:  
     ```bash
     inurl:admin site:example.com
     ```
5. **`ext:`** - Search for specific extensions or file types in URLs.
   - Example:  
     ```bash
     ext:php site:example.com
     ```

### Practical Tools for Google Dorking
1. **Google Dorks Search (Manual)**
   - Using the search operators directly in Google search is the most common way to perform Google Dorking.
   - Example search:  
     ```bash
     site:example.com filetype:pdf "confidential"
     ```

2. **Dork Search by Pentesters (Burp Suite & Google Dorking)**
   - **Burp Suite**: Burp Suite's web vulnerability scanner can be combined with Google Dorks to identify sensitive files, misconfigurations, or vulnerabilities.
   - Example: Using **Burp Suite**’s Intruder or Repeater tool, you can automate the search for certain Google Dorks across multiple domains.

3. **Google Dorking Tools**
   - **Google Dork Tool**: A web-based tool that lets you quickly search Google Dorks across multiple websites or customize dork queries.
   - Example Tool: [https://www.exploit-db.com/google-hacking-database](https://www.exploit-db.com/google-hacking-database)

### Use Cases for Google Dorks
- **Discover exposed information**: Searching for documents, internal files, or sensitive data left open on the web.
- **Security testing**: Finding publicly exposed configuration files, directories, or backup files that can lead to potential exploits.
- **Reconnaissance for penetration testing**: Gather publicly available information about a target, such as login pages, administrative interfaces, or outdated documents.

### Examples of Common Google Dorks
- `filetype:xls inurl:"password"`
- `intitle:"index of" admin`
- `site:gov filetype:pdf confidential`
- `inurl:/backup/ site:example.com`

---

## Ethical Considerations
Both **Wayback URLs** and **Google Dorking** can be powerful tools for security professionals and researchers. However, they should only be used ethically and with permission. Unauthorized scanning of websites or accessing sensitive data could be illegal or result in ethical violations. Always ensure that your actions comply with legal requirements and respect privacy.

# Task 7 : Conclusion

Throughout this room, we have explored various aspects of enumeration and brute force attacks on web applications, equipping you with the knowledge and practical skills needed to conduct thorough security assessments.

## Key Takeaways

- **Effective Enumeration**: Proper enumeration is crucial for identifying potential vulnerabilities in web applications. Using the right tools and techniques can reveal valuable information that aids in planning further attacks.
  
- **Brute Force Efficiency**: Optimizing brute force attacks involves creating intelligent wordlists, managing attack parameters, and avoiding detection mechanisms like rate limiting and account lockout.

- **Ethical Responsibility**: Always conduct enumeration and brute force attacks with explicit permission from the system owner. Unauthorized attacks are illegal and can have severe consequences.
